<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDG UAM: Taller de Magenta.js</title>
    <style>
        body { font-family: 'Google Sans', sans-serif, system-ui; text-align: center; background: #f0f2f5; color: #333; }
        h1 { color: #1a73e8; }
        #generateButton {
            background-color: #4285F4; color: white; border: none; padding: 15px 30px;
            font-size: 18px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s;
        }
        #generateButton:disabled { background-color: #9e9e9e; cursor: not-allowed; }
        /* Le damos un borde al canvas para que sea visible */
        #visualizer { margin-top: 25px; border: 1px solid #ccc; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.23.1/dist/magentamusic.min.js"></script>
</head>
<body>

    <h1>üéµ AI Composer con Magenta.js üéµ</h1>
    <p>¬°Crea m√∫sica con Inteligencia Artificial! Presiona el bot√≥n para continuar la melod√≠a inicial.</p>

    <button id="generateButton">Generar M√∫sica</button>

    <canvas id="visualizer"></canvas>

    <script>
        // --- CONFIGURACI√ìN INICIAL ---
        const rnn = new mm.MusicRNN('https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/basic_rnn');

        let player;

        rnn.initialize().then(() => {
            document.getElementById('generateButton').disabled = false;
            document.getElementById('generateButton').innerText = 'Generar M√∫sica';
        });

        // --- NUESTRA MELOD√çA INICIAL ---
        const miMelodia = {
            notes: [
                {pitch: 60, quantizedStartStep: 0, quantizedEndStep: 2}, // C4
                
            ],
            quantizationInfo: {stepsPerQuarter: 4},
            totalQuantizedSteps: 6,
        };

        // --- LA FUNCI√ìN PARA GENERAR M√öSICA ---
        async function generarContinuacion() {
            if (!player) {
                player = new mm.Player();
            }

            if (player.isPlaying()) {
                player.stop();
                document.getElementById('generateButton').innerText = 'Generar de nuevo';
                return;
            }

            document.getElementById('generateButton').disabled = true;
            document.getElementById('generateButton').innerText = 'Generando... üß†';

            const longitudContinuacion = 40;
            const temperatura = 1.1;

            const continuacion = await rnn.continueSequence(miMelodia, longitudContinuacion, temperatura);
            const melodiaCompleta = mm.sequences.concatenate([miMelodia, continuacion]);

            // Esta l√≠nea ahora funcionar√° porque #visualizer es un <canvas>
            const visualizer = new mm.Visualizer(melodiaCompleta, document.getElementById('visualizer'));

            player.start(melodiaCompleta).then(() => {
                document.getElementById('generateButton').innerText = 'Generar de nuevo';
            });

            document.getElementById('generateButton').disabled = false;
            document.getElementById('generateButton').innerText = '‚ñ† Detener';
        }

        // --- CONECTAR TODO ---
        const generateButton = document.getElementById('generateButton');
        generateButton.onclick = generarContinuacion;
        generateButton.disabled = true;
        generateButton.innerText = 'Cargando IA...';
    </script>
</body>
</html>