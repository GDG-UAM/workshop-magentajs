<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Banda de IA Avanzada</title>
    <style> /* Mismos estilos que antes */ </style>
    <script src="https://cdn.jsdelivr.net/npm/@magenta/music@1.23.1/dist/magentamusic.min.js"></script>
</head>
<body>
    <h1>ğŸµ Mi Banda de TrÃ­o con IA ğŸ¹ğŸ¸ğŸ¥</h1>
    <p>Presiona para generar una base de piano, bajo y baterÃ­a con un modelo avanzado.</p>
    
    <button id="playButton" disabled>Cargando Modelo de TrÃ­o...</button>
    <canvas id="visualizer"></canvas>

    <script>
        // --- 1. PREPARAMOS NUESTRO MÃšSICO AVANZADO ---
        // Usamos el modelo VAE de trÃ­os de 16 compases
        const trioVAE = new mm.MusicVAE('https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/trio_16bar');
        
        let player = new mm.Player();
        let visualizer;

        // --- INICIALIZAMOS EL MODELO Y HABILITAMOS EL BOTÃ“N ---
        trioVAE.initialize().then(() => {
            document.getElementById('playButton').disabled = false;
            document.getElementById('playButton').innerText = 'Â¡Generar TrÃ­o!';
        });

        const playButton = document.getElementById('playButton');
        playButton.onclick = async () => {
            if (player.isPlaying()) {
                player.stop();
                playButton.innerText = 'Â¡Generar TrÃ­o!';
                return;
            }

            playButton.disabled = true;
            playButton.innerText = 'Componiendo...';
            
            // --- 2. GENERAMOS LA BASE DEL TRÃO ---
            // .sample(1) crea una pieza nueva y aleatoria
            const trio = (await trioVAE.sample(1))[0]; 

            // --- 3. VISUALIZAMOS Y REPRODUCIMOS ---
            visualizer = new mm.Visualizer(trio, document.getElementById('visualizer'));
            
            player.start(trio).then(() => {
                playButton.disabled = false;
                playButton.innerText = 'Â¡Generar TrÃ­o!';
            });

            playButton.disabled = false;
            playButton.innerText = 'â–  Detener';
        };
    </script>
</body>
</html>