<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Workshop – MusicVAE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../generic/generic.css" />
  <script src="https://unpkg.com/@magenta/music@1.23.1"></script>
  <script type="module" src="../generic/generic.js"></script>
</head>
<body>
  <header class="bar">
    <input id="songTitle" placeholder="Título de la canción" />
    <div id="transport"></div>
  </header>
  <main class="grid">
    <section class="card">
      <h3>Melodía / Pistas</h3>
      <div id="visualizer" class="viz"></div>
      <div id="tracksPanel"></div>
    </section>
    <aside class="card">
      <h3>Herramientas</h3>
      <div id="trimPanel"></div>
      <div id="saveLoadPanel"></div>
      <hr />
      <h3>Modelos</h3>
      <div id="modelsPanel"></div>
    </aside>
  </main>

  <script type="module">
    import { MusicVaeService } from '../lib/models/musicvae.js';
    import { CHECKPOINTS } from '../lib/config/constants.js';
    import { makeScale } from '../lib/models/baseline.js';

    const vae = new MusicVaeService({
      checkpointURL: CHECKPOINTS.musicvae.melody, // melody/trio según tu URL
      stepsPerQuarter: 4,
      qpm: 120
    });

    window.addEventListener('DOMContentLoaded', () => {
      const panel = document.getElementById('modelsPanel');

      // SAMPLE
      const bSample = document.createElement('button');
      bSample.textContent = 'VAE: Sample (1)';
      bSample.onclick = async () => {
        const [ns] = await vae.sample(1, 0.9);
        App.loadTrack(ns, { name: 'VAE sample', program: 0 });
      };

      // INTERPOLATE entre dos seeds simples
      const bInterp = document.createElement('button');
      bInterp.textContent = 'VAE: Interpolar A↔B';
      bInterp.onclick = async () => {
        const A = makeScale({ tonic: 60, length: 8, step: 2, dur: 0.5 });
        const B = makeScale({ tonic: 67, length: 8, step: 2, dur: 0.5 });
        const outs = await vae.interpolate([A, B], 7, 0.7);
        // Cargamos la 4ª (índice 3) como “intermedia”
        App.replaceMain(outs[3]);
      };

      panel.append(bSample, document.createElement('br'), bInterp);
    });
  </script>
</body>
</html>
